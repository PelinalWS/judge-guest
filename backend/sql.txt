
delete from contests where description = '';
delete from contest_criteria  where criteria_description = '';
delete from projects;


-- DROP TYPE public."role_status";

CREATE TYPE public."role_status" AS ENUM (
	'null',
	'admin',
	'member',
	'user');

-- public.users definition

-- Drop table

-- DROP TABLE users;

CREATE TABLE users (
	userid int4 GENERATED ALWAYS AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"name" varchar NOT NULL,
	email varchar NOT NULL,
	"password" varchar NOT NULL,
	"role" public."role_status" DEFAULT 'null'::role_status NULL,
	role_requested public."role_status" NULL,
	CONSTRAINT users_pk PRIMARY KEY (userid)
);

-- public.contests definition

-- Drop table

-- DROP TABLE contests;

CREATE TABLE contests (
	id int4 GENERATED ALWAYS AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"name" varchar NOT NULL,
	created_by int4 NOT NULL,
	"date" date NOT NULL,
	description varchar NOT NULL,
	members _int4 NULL,
	jury _int4 NULL,
	access_code varchar NOT NULL,
	CONSTRAINT contests_pk PRIMARY KEY (id),
	CONSTRAINT contests_users_fk FOREIGN KEY (created_by) REFERENCES users(userid)
);

-- public.projects definition

-- Drop table

-- DROP TABLE projects;

CREATE TABLE projects (
	id int4 GENERATED ALWAYS AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"name" varchar NOT NULL,
	contest int4 NOT NULL,
	points float4 NULL,
	description varchar NULL,
	CONSTRAINT projects_unique UNIQUE (id),
	CONSTRAINT projects_contests_fk FOREIGN KEY (contest) REFERENCES contests(id)
);

-- public.votes definition

-- Drop table

-- DROP TABLE votes;

CREATE TABLE votes (
	"user" int4 NOT NULL,
	contest int4 NOT NULL,
	project int4 NOT NULL,
	likert _int2 NULL,
	"comment" varchar NULL,
	CONSTRAINT votes_contests_fk FOREIGN KEY (contest) REFERENCES contests(id),
	CONSTRAINT votes_projects_fk FOREIGN KEY (project) REFERENCES projects(id),
	CONSTRAINT votes_users_fk FOREIGN KEY ("user") REFERENCES users(userid)
);

-- public.contest_criteria definition

-- Drop table

-- DROP TABLE contest_criteria;

CREATE TABLE contest_criteria (
	contest_id int4 NOT NULL,
	criteria_id int4 GENERATED ALWAYS AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	criteria_name varchar NOT NULL,
	criteria_description varchar NULL,
	CONSTRAINT contest_criteria_contests_fk FOREIGN KEY (contest_id) REFERENCES contests(id)
);

-- public.contest_jury definition

-- Drop table

-- DROP TABLE contest_jury;

CREATE TABLE contest_jury (
	contest_id int4 NOT NULL,
	user_id int4 NOT NULL,
	CONSTRAINT contest_jury_contests_fk FOREIGN KEY (contest_id) REFERENCES contests(id),
	CONSTRAINT contest_jury_users_fk FOREIGN KEY (user_id) REFERENCES users(userid)
);

-- public.project_teams definition

-- Drop table

-- DROP TABLE project_teams;

CREATE TABLE project_teams (
	project int4 NOT NULL,
	"user" int4 NOT NULL,
	CONSTRAINT project_teams_projects_fk FOREIGN KEY (project) REFERENCES projects(id),
	CONSTRAINT project_teams_users_fk FOREIGN KEY ("user") REFERENCES users(userid)
);